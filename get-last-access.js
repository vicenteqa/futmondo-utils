const response = {
  answer: {
    isAdmin: true,
    teams: [
      {
        id: '6527c04631079349c1155e0d',
        userid: '6527bf532ccd69060ecc4da1',
        name: 'jmcormo',
        photo: 'https://static01.mondocore.com/img/avatars/male/avatar_007.png',
        teamname: 'Cormo United',
        teamslug: 'jmcortes86',
        teamid: '6527c04631079349c1155e0d',
        points: 691,
        teamValue: 357330944,
        lastAccess: '',
        isAdmin: false,
        nln: 52,
        awards: {},
        clauses: {
          w: {
            in: 1,
            out: 0,
          },
          t: {
            in: 26,
            out: 22,
          },
        },
        cw: {
          l: false,
          c: false,
          o: false,
        },
      },
      {
        id: '65284916b02b2049bf91f9bf',
        userid: '6528485154e06a061637e257',
        name: 'carlospg10',
        photo: 'https://cdn.mondocore.com/img/avatars/male/avatar_000.png',
        teamname: 'carlospg10',
        teamslug: 'carlospg10',
        teamid: '65284916b02b2049bf91f9bf',
        points: 687,
        teamValue: 472884737,
        lastAccess: '',
        isAdmin: false,
        nln: 50,
        awards: {},
        clauses: {
          w: {
            in: 1,
            out: 0,
          },
          t: {
            in: 28,
            out: 10,
          },
        },
        cw: {
          l: false,
          c: false,
          o: false,
        },
      },
      {
        id: '652863932d3fc549aa29e343',
        userid: '652862c8a0d05805de803447',
        name: 'Damián',
        photo: 'https://static01.mondocore.com/img/avatars/male/avatar_028.png',
        teamname: 'T-MA FC',
        teamslug: 'demiance',
        teamid: '652863932d3fc549aa29e343',
        points: 655,
        teamValue: 369432827,
        lastAccess: '2024-10-15T21:17:46.151Z',
        isAdmin: true,
        nln: 87,
        awards: {},
        clauses: {
          w: {
            in: 0,
            out: 0,
          },
          t: {
            in: 31,
            out: 23,
          },
        },
        cw: {
          l: false,
          c: false,
          o: false,
        },
      },
      {
        id: '65284c0f2d3fc549aa29c1d7',
        userid: '65284ad654e06a061637e420',
        name: 'jordilo23',
        photo: 'https://cdn.mondocore.com/img/avatars/male/avatar_000.png',
        teamname: 'jordilo23',
        teamslug: 'jordilo23',
        teamid: '65284c0f2d3fc549aa29c1d7',
        points: 650,
        teamValue: 385850285,
        lastAccess: '2024-10-15T20:29:50.780Z',
        isAdmin: false,
        nln: 36,
        awards: {},
        clauses: {
          w: {
            in: 1,
            out: 0,
          },
          t: {
            in: 25,
            out: 43,
          },
        },
        cw: {
          l: false,
          c: false,
          o: false,
        },
      },
      {
        id: '652bc9051485a17231213ec8',
        userid: '652bc64b2ccd69060ecfb26e',
        name: 'Vicente',
        photo: 'https://cdn.mondocore.com/img/avatars/male/avatar_000.png',
        teamname: 'AFC Richmond',
        teamslug: 'vicente',
        teamid: '652bc9051485a17231213ec8',
        points: 640,
        teamValue: 368295367,
        lastAccess: '2024-10-16T05:06:39.990Z',
        isAdmin: true,
        nln: 152,
        awards: {
          o: 0,
          l: 1,
          c: 1,
        },
        clauses: {
          w: {
            in: 1,
            out: 1,
          },
          t: {
            in: 31,
            out: 43,
          },
        },
        cw: {
          l: true,
          c: true,
          o: false,
        },
      },
      {
        id: '66b88a121616a34d2df5aed6',
        userid: '5d2356b8a9afa203db590592',
        name: 'Daniel Gonzalez',
        photo:
          'http://static01.basketmondo.com/img/avatars/male/avatar_000.png',
        teamname: 'Daniel Gonzalez',
        teamslug: 'daniel-gonzalez',
        teamid: '66b88a121616a34d2df5aed6',
        points: 599,
        teamValue: 323866654,
        lastAccess: '2024-10-15T22:14:25.763Z',
        isAdmin: false,
        nln: 0,
        awards: {},
        clauses: {
          w: {
            in: 1,
            out: 2,
          },
          t: {
            in: 10,
            out: 15,
          },
        },
        cw: {
          l: false,
          c: false,
          o: false,
        },
      },
      {
        id: '652843e141dc7349b78ecc55',
        userid: '5d23526c7c5d5440102c3c6c',
        name: 'Davido',
        photo:
          'https://static01.mondocore.com/img/avatars/female/avatar_090.png',
        teamname: 'davi.smith.vega',
        teamslug: 'davismithvega',
        teamid: '652843e141dc7349b78ecc55',
        points: 535,
        teamValue: 328267652,
        lastAccess: '2024-10-15T12:01:43.513Z',
        isAdmin: false,
        nln: 18,
        awards: {},
        clauses: {
          w: {
            in: 1,
            out: 1,
          },
          t: {
            in: 20,
            out: 17,
          },
        },
        cw: {
          l: false,
          c: false,
          o: false,
        },
      },
      {
        id: '66f9809e5a28014b158e596c',
        userid: '66f9800749fb9a0d154cd190',
        name: 'Alex Sánchez Salazar',
        photo:
          'https://lh3.googleusercontent.com/a/ACg8ocJhTHBO3gNl06JGSg-hGptkEu3wrIprGMuyAgaJxOpc4EMqLDw=s96-c',
        teamname: 'Alex Sánchez Salazar',
        teamslug: 'alex-sanchez-salazar',
        teamid: '66f9809e5a28014b158e596c',
        points: 450,
        teamValue: 275341435,
        lastAccess: '2024-10-16T05:04:34.608Z',
        isAdmin: false,
        nln: 0,
        awards: {},
        clauses: {
          w: {
            in: 1,
            out: 3,
          },
          t: {
            in: 2,
            out: 5,
          },
        },
        cw: {
          l: false,
          c: false,
          o: false,
        },
      },
      {
        id: '66c8e229c1b12f13dc43cbaa',
        userid: '5d35cc288f613c24d052812e',
        name: 'Manchester Situ',
        photo:
          'http://static01.basketmondo.com/img/avatars/male/avatar_000.png',
        teamname: 'Situlot',
        teamslug: 'situlot',
        teamid: '66c8e229c1b12f13dc43cbaa',
        points: 427,
        teamValue: 272366201,
        lastAccess: '2024-10-15T11:00:03.204Z',
        isAdmin: false,
        nln: 0,
        awards: {},
        clauses: {
          w: {
            in: 0,
            out: 0,
          },
          t: {
            in: 5,
            out: 6,
          },
        },
        cw: {
          l: false,
          c: false,
          o: false,
        },
      },
    ],
    mode: 'social',
    configuration: {
      budget: 350000000,
      numberOfPlayers: 15,
      moneyPerPoint: 100000,
      moneyPerRanking: 15000000,
      rankingMode: 'flop',
      usersToRank: 3,
      dreamTeamPlayer: 500000,
      mvpPlayer: 500000,
      extraPay: 0,
      marketPlayers: 16,
      bidDuration: 1,
      marketTimes: 1,
      maxPlayersInRoster: 20,
      maxUserteams: 14,
      playerRetention: 1,
      enableAutomaticClauses: true,
      enablingClause: 0,
      playerMoveInDays: 4,
      numberOfRounds: 0,
      fullSeason: true,
      rtv: 'true',
      blc: true,
      dspct: 0.7000000000000001,
      enableCoach: 'true',
      mcpw: 1,
      mnmp: 0.5,
      rcp: -1,
      mtoffset: '-120',
      mtype: 'normal',
      aes: false,
      cne: false,
      remainingNumberOfRounds: -9,
      apm: false,
      loans: true,
      mbmv: true,
      mrl: 1,
      acl: false,
      dbp: true,
      mpm: 5,
      ccr: 2,
      avmb: true,
    },
  },
  query: {
    championshipId: '6527184d361d0805fd6a729b',
  },
  header: {
    token: '9fdd_9741343440e03ed1684f790b97d1cb27',
    userid: '652bc64b2ccd69060ecfb26e',
  },
};

import dayjs from 'dayjs';
import utc from 'dayjs/plugin/utc.js';
import timezone from 'dayjs/plugin/timezone.js';
import { getChampionshipInfo } from './src/endpoints/get-championship-info.js';

dayjs.extend(utc);
dayjs.extend(timezone);

async function getLastAccess() {
  const info = await getChampionshipInfo();

  const teams = response.answer.teams;

  // Filtrar para excluir a Vicente
  const filteredTeams = teams.filter((team) => team.name !== 'Vicente');

  const result = filteredTeams.map((team) => {
    const lastAccessUTC = team.lastAccess || 'desconocido';
    const lastAccessLocal =
      lastAccessUTC !== 'desconocido'
        ? convertToLocalTime(lastAccessUTC)
        : 'desconocido';
    return {
      nombre: removeLastSurname(team.name),
      ultimo_acceso: lastAccessLocal,
      lastAccessUTC:
        lastAccessUTC !== 'desconocido' ? dayjs(lastAccessUTC) : null,
    };
  });

  // Ordenar por último acceso más reciente
  result.sort((a, b) => {
    if (a.lastAccessUTC && b.lastAccessUTC) {
      return b.lastAccessUTC - a.lastAccessUTC;
    } else if (a.lastAccessUTC) {
      return -1;
    } else if (b.lastAccessUTC) {
      return 1;
    } else {
      return 0;
    }
  });

  // Eliminar el campo lastAccessUTC antes de devolver el resultado
  return result.map(({ lastAccessUTC, ...rest }) => rest);
}

function convertToLocalTime(utcDate) {
  const localDate = dayjs.utc(utcDate).tz('Europe/Madrid'); // Convertir de UTC a UTC+2
  return localDate.format('YYYY-MM-DD HH:mm:ss'); // Formato legible para humanos
}

function removeLastSurname(name) {
  const parts = name.split(' ');
  if (parts.length > 2) {
    parts.pop(); // Eliminar el último apellido
  }
  return parts.join(' ');
}

async function main() {
  const result = await getLastAccess();
  console.log(result);
}

main();
